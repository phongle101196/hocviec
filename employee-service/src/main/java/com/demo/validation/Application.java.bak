package com.example.validation;

import com.example.validation.model.*;
import com.example.validation.service.ValidationContext;
import com.example.validation.service.ValidationModule;
import com.example.validation.service.ValidatorFactory;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;

import java.util.Map;

@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

    @Bean
    public ValidationContext validationContext() {
        ValidationContext context = new ValidationContext();

        // Define class metadata
        ClassMeta userClass = new ClassMeta("User", "user");
        FieldMeta usernameField = new FieldMeta("username", "JAVA.LANG.STRING", "STRING");
        usernameField.addAttribute(ValidatorFactory.getInstance().getAttributeRule("MIN_MAX_LENGTH", Map.of("min", "5", "max", "20")));
        usernameField.addAttribute(ValidatorFactory.getInstance().getAttributeRule("ALLOWED_CHARACTERS", Map.of("allowed_chars", "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")));
        userClass.addField(usernameField);

        FieldMeta ageField = new FieldMeta("age", "JAVA.LANG.INTEGER", "INTEGER");
        ageField.addAttribute(ValidatorFactory.getInstance().getAttributeRule("MIN_MAX_VALUE", Map.of("min", "18", "max", "99")));
        userClass.addField(ageField);

        context.addClassMeta("user", userClass);

        return context;
    }

    @Bean
    public ValidationModule validationModule(ValidationContext context) {
        return new ValidationModule(context);
    }
}